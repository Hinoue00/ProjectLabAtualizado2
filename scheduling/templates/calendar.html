<!-- scheduling/templates/calendar.html -->
{% extends 'base.html' %}
{% load static %}
{% block title %}Calendário de Agendamentos | LabConnect{% endblock %}

{% block extra_css %}
<style>
    /* Variáveis do tema mobile-first */
    :root {
        --calendar-header-bg: rgba(74, 111, 165, 0.05);
        --event-bg: rgba(74, 111, 165, 0.1);
        --event-hover: rgba(74, 111, 165, 0.15);
        --today-color: #4a6fa5;
        --weekend-bg: rgba(0, 0, 0, 0.02);
        --mobile-breakpoint: 768px;
        --tablet-breakpoint: 1024px;
        --touch-target-min: 44px;
    }
    
    [data-theme="dark"] {
        --calendar-header-bg: rgba(74, 111, 165, 0.1);
        --event-bg: rgba(74, 111, 165, 0.2);
        --event-hover: rgba(74, 111, 165, 0.3);
        --weekend-bg: rgba(255, 255, 255, 0.03);
    }
    
    /* Container principal mobile-first */
    .calendar-container {
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        overflow: hidden;
        margin-bottom: 1rem;
    }
    
    /* Header responsivo */
    .calendar-header {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        background-color: var(--calendar-header-bg);
        border-bottom: 1px solid var(--border-color);
    }
    
    @media (min-width: 768px) {
        .calendar-header {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
        }
    }
    
    .calendar-title {
        font-weight: 600;
        display: flex;
        align-items: center;
        font-size: 1.1rem;
        color: var(--text-color);
    }
    
    .calendar-title i {
        margin-right: 0.5rem;
        color: var(--primary-color);
        font-size: 1.2rem;
    }
    
    /* Navegação mobile-optimized */
    .calendar-navigation {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .calendar-nav-btn {
        min-width: var(--touch-target-min);
        min-height: var(--touch-target-min);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background-color: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-color);
        transition: all 0.2s ease;
        cursor: pointer;
        touch-action: manipulation;
        font-size: 0.875rem;
    }
    
    .calendar-nav-btn:hover,
    .calendar-nav-btn:active {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }
    
    .calendar-nav-btn.today {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    /* Visualização mobile - Vista de lista */
    .calendar-view-toggle {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
        padding: 0 1rem;
    }
    
    @media (min-width: 768px) {
        .calendar-view-toggle {
            display: none;
        }
    }
    
    .view-toggle-btn {
        flex: 1;
        padding: 0.5rem;
        border: 1px solid var(--border-color);
        background-color: transparent;
        color: var(--text-color);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        touch-action: manipulation;
    }
    
    .view-toggle-btn.active {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    /* Grid do calendário - Mobile */
    .calendar-mobile-view {
        display: block;
        padding: 1rem;
    }
    
    .calendar-desktop-view {
        display: none;
    }
    
    @media (min-width: 768px) {
        .calendar-mobile-view {
            display: none;
        }
        
        .calendar-desktop-view {
            display: block;
            padding: 1.5rem;
        }
    }
    
    /* Vista de lista mobile */
    .mobile-day-card {
        background-color: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
        transition: all 0.2s ease;
    }
    
    .mobile-day-card.today {
        border-color: var(--today-color);
        box-shadow: 0 0 0 2px rgba(74, 111, 165, 0.2);
    }
    
    .mobile-day-header {
        background-color: var(--calendar-header-bg);
        padding: 1rem;
        border-bottom: 1px solid var(--border-color);
    }
    
    .mobile-day-date {
        font-weight: 600;
        color: var(--text-color);
        font-size: 1rem;
    }
    
    .mobile-day-weekday {
        font-size: 0.875rem;
        color: var(--text-muted);
    }
    
    .mobile-day-content {
        padding: 1rem;
    }
    
    .mobile-no-events {
        text-align: center;
        color: var(--text-muted);
        font-size: 0.875rem;
        padding: 1rem 0;
    }
    
    /* Eventos mobile */
    .mobile-event-item {
        background-color: var(--event-bg);
        border-radius: 8px;
        padding: 0.75rem;
        margin-bottom: 0.5rem;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
        touch-action: manipulation;
    }
    
    .mobile-event-item:active {
        background-color: var(--event-hover);
        transform: scale(0.98);
    }
    
    .mobile-event-time {
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--primary-color);
        margin-bottom: 0.25rem;
    }
    
    .mobile-event-title {
        font-size: 0.875rem;
        color: var(--text-color);
        margin-bottom: 0.25rem;
    }
    
    .mobile-event-details {
        font-size: 0.75rem;
        color: var(--text-muted);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .mobile-event-details i {
        font-size: 0.75rem;
    }
    
    .mobile-event-status {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }
    
    .status-approved {
        background-color: #198754;
    }
    
    .status-pending {
        background-color: #ffc107;
    }
    
    .status-rejected {
        background-color: #dc3545;
    }
    
    /* Desktop view */
    .calendar-month-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background-color: var(--border-color);
        border-radius: 8px;
        overflow: hidden;
    }
    
    .calendar-weekdays {
        display: contents;
    }
    
    .calendar-weekday {
        background-color: var(--calendar-header-bg);
        padding: 1rem;
        text-align: center;
        font-weight: 600;
        font-size: 0.875rem;
        color: var(--text-color);
    }
    
    .calendar-day {
        background-color: var(--card-bg);
        min-height: 120px;
        padding: 0.5rem;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .calendar-day:hover {
        background-color: var(--calendar-header-bg);
    }
    
    .calendar-day.other-month {
        opacity: 0.4;
    }
    
    .calendar-day.today {
        background-color: rgba(74, 111, 165, 0.05);
    }
    
    .calendar-day-number {
        font-weight: 600;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
        color: var(--text-color);
    }
    
    .calendar-day.today .calendar-day-number {
        color: var(--today-color);
        font-weight: 700;
    }
    
    /* Filtros responsivos */
    .calendar-filters {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        background-color: var(--calendar-header-bg);
        border-bottom: 1px solid var(--border-color);
    }
    
    @media (min-width: 768px) {
        .calendar-filters {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }
    }
    
    .filter-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
    }
    
    .filter-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--text-color);
        margin-right: 0.5rem;
    }
    
    .filter-select {
        padding: 0.5rem 1rem;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--card-bg);
        color: var(--text-color);
        font-size: 0.875rem;
        cursor: pointer;
        min-width: 150px;
    }
    
    /* Loading state */
    .calendar-loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;
    }
    
    .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--border-color);
        border-top-color: var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Swipe hint for mobile */
    .swipe-hint {
        display: block;
        text-align: center;
        color: var(--text-muted);
        font-size: 0.75rem;
        padding: 0.5rem;
        margin-top: 0.5rem;
    }
    
    @media (min-width: 768px) {
        .swipe-hint {
            display: none;
        }
    }
    
    /* Acessibilidade */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
    
    /* Touch feedback */
    @media (hover: none) {
        .calendar-nav-btn:active,
        .mobile-event-item:active,
        .calendar-day:active {
            opacity: 0.8;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="content-container">
    <!-- Cabeçalho da página -->
    <div class="page-header mb-4">
        <div class="row align-items-center">
            <div class="col-12 col-md-6 mb-3 mb-md-0">
                <h1 class="page-title">Calendário de Agendamentos</h1>
                <p class="page-subtitle">Visualize e gerencie os agendamentos dos laboratórios</p>
            </div>
            <div class="col-12 col-md-6 text-md-end">
                {% if user.user_type == 'professor' and is_scheduling_day %}
                    <a href="{% url 'create_schedule_request' %}" class="btn btn-primary w-100 w-md-auto">
                        <i class="bi bi-plus-lg me-1"></i> Solicitar Agendamento
                    </a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="calendar-container">
        <!-- Header do calendário -->
        <div class="calendar-header">
            <h5 class="calendar-title">
                <i class="bi bi-calendar3"></i>
                <span id="calendar-month-year">{{ current_month_year }}</span>
            </h5>
            
            <div class="calendar-navigation">
                <button class="calendar-nav-btn" id="prev-month" aria-label="Mês anterior">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="calendar-nav-btn today" id="today-btn">
                    Hoje
                </button>
                <button class="calendar-nav-btn" id="next-month" aria-label="Próximo mês">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Filtros -->
        <div class="calendar-filters">
            <div class="filter-group">
                <label class="filter-label" for="lab-filter">Laboratório:</label>
                <select class="filter-select" id="lab-filter">
                    <option value="all">Todos os laboratórios</option>
                    {% for lab in laboratories %}
                        <option value="{{ lab.id }}">{{ lab.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="filter-group">
                <label class="filter-label" for="status-filter">Status:</label>
                <select class="filter-select" id="status-filter">
                    <option value="all">Todos</option>
                    <option value="approved">Aprovados</option>
                    <option value="pending">Pendentes</option>
                    <option value="rejected">Rejeitados</option>
                </select>
            </div>
        </div>

        <!-- Toggle de visualização mobile -->
        <div class="calendar-view-toggle">
            <button class="view-toggle-btn active" data-view="list">
                <i class="bi bi-list-ul"></i> Lista
            </button>
            <button class="view-toggle-btn" data-view="grid">
                <i class="bi bi-grid-3x3"></i> Grade
            </button>
        </div>

        <!-- Vista mobile (lista) -->
        <div class="calendar-mobile-view" id="mobile-calendar">
            <!-- Conteúdo será inserido via JavaScript -->
            <div class="calendar-loading">
                <div class="spinner"></div>
            </div>
        </div>

        <!-- Vista desktop (grade) -->
        <div class="calendar-desktop-view" id="desktop-calendar">
            <div class="calendar-month-grid">
                <!-- Dias da semana -->
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">Dom</div>
                    <div class="calendar-weekday">Seg</div>
                    <div class="calendar-weekday">Ter</div>
                    <div class="calendar-weekday">Qua</div>
                    <div class="calendar-weekday">Qui</div>
                    <div class="calendar-weekday">Sex</div>
                    <div class="calendar-weekday">Sáb</div>
                </div>
                <!-- Dias do mês serão inseridos via JavaScript -->
            </div>
        </div>

        <div class="swipe-hint">
            <i class="bi bi-arrow-left-right"></i> Deslize para navegar entre os dias
        </div>
    </div>
</div>

<!-- Modal de detalhes do evento -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eventModalLabel">Detalhes do Agendamento</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
            </div>
            <div class="modal-body" id="eventModalBody">
                <!-- Conteúdo será inserido via JavaScript -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Variáveis globais
    let currentDate = new Date();
    let currentView = 'list'; // mobile default
    let events = {{ events|safe|default:"[]" }};
    let selectedLab = 'all';
    let selectedStatus = 'all';
    
    // Detectar se é mobile
    const isMobile = window.innerWidth < 768;
    
    // Elementos DOM
    const monthYearElement = document.getElementById('calendar-month-year');
    const mobileCalendar = document.getElementById('mobile-calendar');
    const desktopCalendar = document.getElementById('desktop-calendar');
    const prevButton = document.getElementById('prev-month');
    const nextButton = document.getElementById('next-month');
    const todayButton = document.getElementById('today-btn');
    const labFilter = document.getElementById('lab-filter');
    const statusFilter = document.getElementById('status-filter');
    const viewToggleButtons = document.querySelectorAll('.view-toggle-btn');
    
    // Funções de utilidade
    function formatDate(date) {
        const options = { year: 'numeric', month: 'long' };
        return date.toLocaleDateString('pt-BR', options);
    }
    
    function formatDateShort(date) {
        const options = { day: '2-digit', month: '2-digit' };
        return date.toLocaleDateString('pt-BR', options);
    }
    
    function formatTime(time) {
        return time.substring(0, 5);
    }
    
    function isToday(date) {
        const today = new Date();
        return date.getDate() === today.getDate() &&
               date.getMonth() === today.getMonth() &&
               date.getFullYear() === today.getFullYear();
    }
    
    function getDaysInMonth(date) {
        return new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
    }
    
    function getFirstDayOfMonth(date) {
        return new Date(date.getFullYear(), date.getMonth(), 1).getDay();
    }
    
    // Filtrar eventos
    function filterEvents(events) {
        return events.filter(event => {
            const labMatch = selectedLab === 'all' || event.laboratory_id == selectedLab;
            const statusMatch = selectedStatus === 'all' || event.status === selectedStatus;
            return labMatch && statusMatch;
        });
    }
    
    // Renderizar calendário mobile (lista)
    function renderMobileCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = getDaysInMonth(currentDate);
        const filteredEvents = filterEvents(events);
        
        let html = '';
        
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayEvents = filteredEvents.filter(e => e.date === dateStr);
            const isCurrentDay = isToday(date);
            
            html += `
                <div class="mobile-day-card ${isCurrentDay ? 'today' : ''}">
                    <div class="mobile-day-header">
                        <div class="mobile-day-date">${day} de ${date.toLocaleDateString('pt-BR', { month: 'long' })}</div>
                        <div class="mobile-day-weekday">${date.toLocaleDateString('pt-BR', { weekday: 'long' })}</div>
                    </div>
                    <div class="mobile-day-content">
            `;
            
            if (dayEvents.length === 0) {
                html += '<div class="mobile-no-events">Nenhum agendamento</div>';
            } else {
                dayEvents.forEach(event => {
                    html += `
                        <div class="mobile-event-item" data-event-id="${event.id}">
                            <div class="mobile-event-status status-${event.status}"></div>
                            <div class="mobile-event-time">
                                <i class="bi bi-clock"></i> ${formatTime(event.start_time)} - ${formatTime(event.end_time)}
                            </div>
                            <div class="mobile-event-title">${event.laboratory_name}</div>
                            <div class="mobile-event-details">
                                <i class="bi bi-person"></i> ${event.professor_name}
                                <span>•</span>
                                <i class="bi bi-book"></i> ${event.subject}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                    </div>
                </div>
            `;
        }
        
        mobileCalendar.innerHTML = html;
        
        // Adicionar event listeners
        document.querySelectorAll('.mobile-event-item').forEach(item => {
            item.addEventListener('click', function() {
                const eventId = this.dataset.eventId;
                showEventDetails(eventId);
            });
        });
    }
    
    // Renderizar calendário desktop (grade)
    function renderDesktopCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const firstDay = getFirstDayOfMonth(currentDate);
        const daysInMonth = getDaysInMonth(currentDate);
        const filteredEvents = filterEvents(events);
        
        let html = '';
        
        // Dias da semana
        const weekdays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
        weekdays.forEach(day => {
            html += `<div class="calendar-weekday">${day}</div>`;
        });
        
        // Dias vazios do início
        for (let i = 0; i < firstDay; i++) {
            html += '<div class="calendar-day other-month"></div>';
        }
        
        // Dias do mês
        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayEvents = filteredEvents.filter(e => e.date === dateStr);
            const isCurrentDay = isToday(date);
            
            html += `
                <div class="calendar-day ${isCurrentDay ? 'today' : ''}" data-date="${dateStr}">
                    <div class="calendar-day-number">${day}</div>
            `;
            
            dayEvents.slice(0, 3).forEach(event => {
                html += `
                    <div class="calendar-event status-${event.status}" data-event-id="${event.id}">
                        <span class="event-time">${formatTime(event.start_time)}</span>
                        <span class="event-title">${event.laboratory_name}</span>
                    </div>
                `;
            });
            
            if (dayEvents.length > 3) {
                html += `<div class="calendar-more">+${dayEvents.length - 3} mais</div>`;
            }
            
            html += '</div>';
        }
        
        desktopCalendar.querySelector('.calendar-month-grid').innerHTML = html;
        
        // Adicionar event listeners
        document.querySelectorAll('.calendar-event').forEach(item => {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                const eventId = this.dataset.eventId;
                showEventDetails(eventId);
            });
        });
    }
    
    // Mostrar detalhes do evento
    function showEventDetails(eventId) {
        const event = events.find(e => e.id == eventId);
        if (!event) return;
        
        const modalBody = document.getElementById('eventModalBody');
        modalBody.innerHTML = `
            <div class="event-detail">
                <h6><i class="bi bi-building"></i> Laboratório</h6>
                <p>${event.laboratory_name}</p>
            </div>
            <div class="event-detail">
                <h6><i class="bi bi-calendar3"></i> Data</h6>
                <p>${new Date(event.date).toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
            </div>
            <div class="event-detail">
                <h6><i class="bi bi-clock"></i> Horário</h6>
                <p>${formatTime(event.start_time)} - ${formatTime(event.end_time)}</p>
            </div>
            <div class="event-detail">
                <h6><i class="bi bi-person"></i> Professor</h6>
                <p>${event.professor_name}</p>
            </div>
            <div class="event-detail">
                <h6><i class="bi bi-book"></i> Disciplina</h6>
                <p>${event.subject}</p>
            </div>
            <div class="event-detail">
                <h6><i class="bi bi-info-circle"></i> Status</h6>
                <p><span class="badge bg-${event.status === 'approved' ? 'success' : event.status === 'pending' ? 'warning' : 'danger'}">${event.status === 'approved' ? 'Aprovado' : event.status === 'pending' ? 'Pendente' : 'Rejeitado'}</span></p>
            </div>
        `;
        
        const modal = new bootstrap.Modal(document.getElementById('eventModal'));
        modal.show();
    }
    
    // Atualizar calendário
    function updateCalendar() {
        monthYearElement.textContent = formatDate(currentDate);
        
        if (isMobile && currentView === 'list') {
            renderMobileCalendar();
        } else {
            renderDesktopCalendar();
        }
    }
    
    // Event listeners
    prevButton.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendar();
    });
    
    nextButton.addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendar();
    });
    
    todayButton.addEventListener('click', function() {
        currentDate = new Date();
        updateCalendar();
    });
    
    labFilter.addEventListener('change', function() {
        selectedLab = this.value;
        updateCalendar();
    });
    
    statusFilter.addEventListener('change', function() {
        selectedStatus = this.value;
        updateCalendar();
    });
    
    // Toggle de visualização mobile
    viewToggleButtons.forEach(button => {
        button.addEventListener('click', function() {
            viewToggleButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentView = this.dataset.view;
            
            if (currentView === 'list') {
                mobileCalendar.style.display = 'block';
                desktopCalendar.style.display = 'none';
                renderMobileCalendar();
            } else {
                mobileCalendar.style.display = 'none';
                desktopCalendar.style.display = 'block';
                renderDesktopCalendar();
            }
        });
    });
    
    // Gestos de swipe para mobile
    let touchStartX = 0;
    let touchEndX = 0;
    
    function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
            if (diff > 0) {
                // Swipe left - próximo mês
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateCalendar();
            } else {
                // Swipe right - mês anterior
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateCalendar();
            }
        }
    }
    
    if (isMobile) {
        mobileCalendar.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
        });
        
        mobileCalendar.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });
    }
    
    // Responsive handler
    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            const newIsMobile = window.innerWidth < 768;
            if (newIsMobile !== isMobile) {
                location.reload(); // Recarregar para ajustar layout
            }
        }, 250);
    });
    
    // Inicializar calendário
    updateCalendar();
    
    // Adicionar indicador de carregamento ao fazer fetch
    async function fetchEvents() {
        try {
            const response = await fetch(`/api/calendar/events?month=${currentDate.getMonth() + 1}&year=${currentDate.getFullYear()}`);
            const data = await response.json();
            events = data.events;
            updateCalendar();
        } catch (error) {
            console.error('Erro ao carregar eventos:', error);
        }
    }
});
</script>
{% endblock %}